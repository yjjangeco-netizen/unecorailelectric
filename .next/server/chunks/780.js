exports.id=780,exports.ids=[780],exports.modules={17072:(a,b,c)=>{"use strict";c.d(b,{vV:()=>g,Jm:()=>h});class d{constructor(){this.logLevel="info",this.logLevel=this.getLogLevel()}getLogLevel(){return process.env.NEXT_PUBLIC_LOG_LEVEL||process.env.LOG_LEVEL||"info"}shouldLog(a){let b={debug:0,info:1,warn:2,error:3};return b[a]>=b[this.logLevel]}formatLog(a){let{timestamp:b,level:c,message:d,context:e,data:f,error:g}=a,h=`[${b}] ${c.toUpperCase()}`;return e&&(h+=` [${e}]`),h+=`: ${d}`,f&&Object.keys(f).length>0&&(h+=`
Data: ${JSON.stringify(f,null,2)}`),g&&(h+=`
Error: ${g.message}`,g.stack&&(h+=`
Stack: ${g.stack}`)),h}log(a,b,c,d,e){if(!this.shouldLog(a))return;let f={timestamp:new Date().toISOString(),level:a,message:b,context:c,data:d,error:e},g=this.formatLog(f);switch(this.sendToExternalLogger(f),a){case"debug":console.warn(`[DEBUG] ${g}`);break;case"info":console.warn(`[INFO] ${g}`);break;case"warn":console.warn(g);break;case"error":console.error(g)}}sendToExternalLogger(a){"error"===a.level&&console.error(this.formatLog(a))}debug(a,b,c){this.log("debug",a,b,c)}info(a,b,c){this.log("info",a,b,c)}warn(a,b,c){this.log("warn",a,b,c)}error(a,b,c,d){this.log("error",a,b,d,c)}context(a){return{debug:(b,c)=>this.debug(b,a,c),info:(b,c)=>this.info(b,a,c),warn:(b,c)=>this.warn(b,a,c),error:(b,c,d)=>this.error(b,a,c,d)}}}let e=new d,f={debug:e.debug.bind(e),info:e.info.bind(e),warn:e.warn.bind(e),error:e.error.bind(e),context:e.context.bind(e)},g=(a,b,c)=>{let d={timestamp:new Date().toISOString(),context:a,error:b instanceof Error?{message:b.message,stack:b.stack,name:b.name}:b,additionalInfo:c,userAgent:"Server",url:"Unknown"};f.error(a,"ErrorLogger",b instanceof Error?b:Error(String(b)),{...c,timestamp:d.timestamp,userAgent:d.userAgent,url:d.url})},h=async(a,b)=>{let c=performance.now();try{let d=await b(),e=performance.now();return f.debug(`${a} 실행 완료`,"AsyncPerformance",{executionTime:`${(e-c).toFixed(2)}ms`}),d}catch(d){let b=performance.now();throw f.error(`${a} 실행 실패`,"AsyncPerformance",d instanceof Error?d:Error(String(d)),{executionTime:`${(b-c).toFixed(2)}ms`}),d}}},30776:(a,b,c)=>{"use strict";c.d(b,{IM:()=>f,jT:()=>i});var d=c(56621),e=c(17072),f=function(a){return a.LOGIN="login",a.LOGOUT="logout",a.LOGIN_FAILED="login_failed",a.PASSWORD_CHANGE="password_change",a.SESSION_EXPIRED="session_expired",a.PERMISSION_DENIED="permission_denied",a.ROLE_CHANGE="role_change",a.ACCESS_GRANTED="access_granted",a.ACCESS_REVOKED="access_revoked",a.STOCK_IN="stock_in",a.STOCK_OUT="stock_out",a.STOCK_ADJUSTMENT="stock_adjustment",a.STOCK_DISPOSAL="stock_disposal",a.STOCK_TRANSFER="stock_transfer",a.USER_CREATED="user_created",a.USER_UPDATED="user_updated",a.USER_DELETED="user_deleted",a.USER_ACTIVATED="user_activated",a.USER_DEACTIVATED="user_deactivated",a.BACKUP_CREATED="backup_created",a.SYSTEM_MAINTENANCE="system_maintenance",a.CONFIGURATION_CHANGED="configuration_changed",a.ERROR_OCCURRED="error_occurred",a.CLOSING_COMPLETE="closing_complete",a.CLOSING_ROLLBACK="closing_rollback",a}({});class g{constructor(){this.supabase=(0,d.kG)()}static getInstance(){return g.instance||(g.instance=new g),g.instance}async log(a){try{let b={...a,timestamp:new Date().toISOString(),ip_address:await this.getClientIP(),user_agent:this.getUserAgent()},{error:c}=await this.supabase.from("audit_logs").insert(b);if(c)throw Error(`감사 로그 저장 실패: ${c.message}`);("error"===a.level||"critical"===a.level)&&console.error("\uD83D\uDD34 감사 로그 (Critical):",{action:a.action,user:a.username,details:a.details})}catch(b){(0,e.vV)("감사 로그 기록 실패",b,{auditEntry:a})}}async logAuthentication(a,b,c,d,e={},f="info"){await this.log({user_id:b,username:c,user_role:d,category:"authentication",action:a,level:f,details:e,session_id:e.sessionId,request_id:e.requestId})}async logStockOperation(a,b,c,d,e,f,g={},h="info"){await this.log({user_id:b,username:c,user_role:d,category:"stock_management",action:a,level:h,resource_type:e,resource_id:f,details:g,session_id:g.sessionId,request_id:g.requestId})}async logAuthorization(a,b,c,d,e={},f="warning"){await this.log({user_id:b,username:c,user_role:d,category:"authorization",action:a,level:f,details:e,session_id:e.sessionId,request_id:e.requestId})}async logSystemOperation(a,b,c,d,e={},f="info"){await this.log({user_id:b,username:c,user_role:d,category:"system_operation",action:a,level:f,details:e,session_id:e.sessionId,request_id:e.requestId})}async getClientIP(){try{let a=await fetch("https://api.ipify.org?format=json");return(await a.json()).ip||"unknown"}catch(a){return"unknown"}}getUserAgent(){return"unknown"}async getAuditLogs(a={}){try{let b=this.supabase.from("audit_logs").select("*",{count:"exact"}).order("timestamp",{ascending:!1});a.startDate&&(b=b.gte("timestamp",a.startDate)),a.endDate&&(b=b.lte("timestamp",a.endDate)),a.category&&(b=b.eq("category",a.category)),a.action&&(b=b.eq("action",a.action)),a.userId&&(b=b.eq("user_id",a.userId)),a.level&&(b=b.eq("level",a.level)),a.limit&&(b=b.limit(a.limit)),a.offset&&(b=b.range(a.offset,(a.offset||0)+(a.limit||100)-1));let{data:c,error:d,count:e}=await b;if(d)throw Error(`감사 로그 조회 실패: ${d.message}`);return{data:c||[],count:e||0}}catch(b){return(0,e.vV)("감사 로그 조회 실패",b,{filters:a}),{data:[],count:0,error:b instanceof Error?b.message:"알 수 없는 오류"}}}async exportAuditLogs(a={}){try{let{data:b}=await this.getAuditLogs({...a,limit:1e4});if(0===b.length)return"";return["Timestamp,User ID,Username,User Role,IP Address,Category,Action,Level,Resource Type,Resource ID,Details,Metadata",...b.map(a=>[a.timestamp,a.user_id,a.username,a.user_role,a.ip_address,a.category,a.action,a.level,a.resource_type||"",a.resource_id||"",JSON.stringify(a.details),JSON.stringify(a.metadata||{})].join(","))].join("\n")}catch(b){throw(0,e.vV)("감사 로그 내보내기 실패",b,{filters:a}),b}}}let h=g.getInstance(),i=g.getInstance();h.logAuthentication.bind(h),h.logStockOperation.bind(h),h.logAuthorization.bind(h),h.logSystemOperation.bind(h)},56621:(a,b,c)=>{"use strict";c.d(b,{kG:()=>g,zw:()=>h});var d=c(83008);let e=process.env.NEXT_PUBLIC_SUPABASE_URL||"https://example.supabase.co",f=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"example-key";if(!process.env.NEXT_PUBLIC_SUPABASE_URL||!process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY)throw Error("Missing Supabase environment variables. Please check your .env.local file.");let g=()=>(0,d.UU)(e,f,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}}),h=()=>(0,d.UU)(e,f,{auth:{autoRefreshToken:!1,persistSession:!1}});(0,d.UU)(e,f,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}})},78335:()=>{},96487:()=>{}};